#!/bin/bash

CONTINUE=1
send_signal_to_process () {
    echo "Terminating from record script upon user SIGINT"
    CONTINUE=
}
trap send_signal_to_process SIGINT

if ! pkill -SIGTERM -f 'record_test.py' &>/dev/null; then
    if [[ "$@" != *--no-start* ]]; then
        ./record_test.py 2>&1 | (trap '' SIGINT; tee test_record.out)
        while [[ -n "$CONTINUE" ]]; do
            sleep 2
            {
                for i in $(seq 1 20); do
                    echo ""
                done
                echo "================================================================================================================================================================";
                echo "================================================================================================================================================================";
                echo "==== Record Server Restart =====================================================================================================================================";
                echo "================================================================================================================================================================";
                echo "================================================================================================================================================================";
                ./record_test.py 2>&1
            } | (trap '' SIGINT; tee test_record.out)
        done
    fi
fi
