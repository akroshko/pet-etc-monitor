#!/bin/bash

CONTINUE=1
send_signal_to_process () {
    echo "Terminating from view script upon user SIGINT"
    CONTINUE=
}
trap send_signal_to_process SIGINT

if ! pkill -SIGTERM -f 'test_view_app.py' &>/dev/null; then
    if [[ "$@" != *--no-start* ]]; then
        ./exec_venv.sh ./test_view_app.py 2>&1 | (trap '' SIGINT; tee test_view_app.out)
        while [[ -n "$CONTINUE" ]]; do
            sleep 2
            {
                for i in $(seq 1 20); do
                    echo ""
                done
                echo "================================================================================================================================================================";
                echo "================================================================================================================================================================";
                echo "==== View App Restart =======================================================================================================================================";
                echo "================================================================================================================================================================";
                echo "================================================================================================================================================================";
                ./exec_venv.sh ./test_view_app.py 2>&1
            } | (trap '' SIGINT; tee test_view_app.out)
        done
    fi
fi
